## ADDED Requirements

### Requirement: マクロ記録
システムは `q` でマクロ記録を開始/停止しなければならない（SHALL）。

#### Scenario: 記録開始
- **WHEN** ユーザーが記録中でない状態でSelection Modeで `q` を押す
- **THEN** マクロ記録が開始されなければならない（SHALL）
- **THEN** モードラインに記録中を示す表示（例：「[REC]」）がされなければならない（SHALL）

#### Scenario: 記録停止
- **WHEN** ユーザーが記録中にSelection Modeで `q` を押す
- **THEN** マクロ記録が停止されなければならない（SHALL）
- **THEN** モードラインの記録インジケータは削除されなければならない（SHALL）

#### Scenario: 空のマクロ
- **WHEN** ユーザーがアクションなしで記録を開始してすぐに停止する
- **THEN** マクロは保存されてはならない（SHALL NOT）

### Requirement: マクロ再生
システムは `Q` で最後のマクロを再生しなければならない（SHALL）。

#### Scenario: マクロを再生
- **WHEN** ユーザーがマクロ記録後にSelection Modeで `Q` を押す
- **THEN** 記録されたマクロが実行されなければならない（SHALL）

#### Scenario: 回数付きでマクロを再生
- **WHEN** ユーザーがSelection Modeで `C-u 5 Q` を押す
- **THEN** マクロは5回実行されなければならない（SHALL）

#### Scenario: マクロが記録されていない
- **WHEN** ユーザーがマクロを記録せずに `Q` を押す
- **THEN** ユーザーに「マクロが記録されていません」と通知されなければならない（SHALL）

### Requirement: マクロエラー処理
システムはマクロ実行中のエラーを処理しなければならない（SHALL）。

#### Scenario: 再生中のエラー
- **WHEN** マクロ実行中にエラーが発生する
- **THEN** 実行はエラーポイントで停止しなければならない（SHALL）
- **THEN** ユーザーにエラーが通知されなければならない（SHALL）

### Requirement: レジスタへの位置保存
システムは `' {reg} SPC` で位置をレジスタに保存しなければならない（SHALL）。

#### Scenario: 位置を保存
- **WHEN** ユーザーがSelection Modeで `' a SPC` を押す
- **THEN** 現在のポイント位置がレジスタ 'a' に保存されなければならない（SHALL）

#### Scenario: ウィンドウ付きで位置を保存
- **WHEN** ユーザーがSelection Modeで `' a SPC` を押す
- **THEN** バッファとウィンドウ設定も保存されてもよい（MAY）

### Requirement: レジスタの位置へジャンプ
システムは `' {reg}` で保存された位置にジャンプしなければならない（SHALL）。

#### Scenario: 位置へジャンプ
- **WHEN** ユーザーがレジスタ 'a' に位置を保存した後に `' a` を押す
- **THEN** ポイントは保存された位置に移動しなければならない（SHALL）

#### Scenario: 別のバッファへジャンプ
- **WHEN** ユーザーが `' a` を押しレジスタ 'a' が別のバッファを指している
- **THEN** そのバッファが表示されなければならない（SHALL）
- **THEN** ポイントは保存された位置に移動しなければならない（SHALL）

#### Scenario: 無効なレジスタ
- **WHEN** ユーザーが `' a` を押しレジスタ 'a' が空
- **THEN** ユーザーに「レジスタ 'a' は空です」と通知されなければならない（SHALL）

### Requirement: レジスタへのテキスト保存
システムは `' {reg} w` でテキストをレジスタに保存しなければならない（SHALL）。

#### Scenario: テキストを保存
- **WHEN** ユーザーがリージョンを選択して `' a w` を押す
- **THEN** 選択されたテキストがレジスタ 'a' に保存されなければならない（SHALL）
- **THEN** バッファ内のテキストは変更されてはならない（SHALL NOT）

#### Scenario: 選択なしで保存
- **WHEN** ユーザーが選択なしで `' a w` を押す
- **THEN** 現在の行がレジスタ 'a' に保存されなければならない（SHALL）

### Requirement: レジスタからのテキスト挿入
システムは `' {reg} y` でレジスタからテキストを挿入しなければならない（SHALL）。

#### Scenario: テキストを挿入
- **WHEN** ユーザーがレジスタ 'a' にテキストを保存した後に `' a y` を押す
- **THEN** 保存されたテキストがポイントに挿入されなければならない（SHALL）

#### Scenario: 選択をレジスタで置換
- **WHEN** ユーザーがリージョンを選択して `' a y` を押す
- **THEN** 選択されたテキストはレジスタ 'a' のコンテンツで置換されなければならない（SHALL）

#### Scenario: 空のレジスタ
- **WHEN** ユーザーが `' a y` を押しレジスタ 'a' が空または位置を含む
- **THEN** ユーザーに適切に通知されなければならない（SHALL）

### Requirement: レジスタ一覧
システムはレジスタの概要を提供しなければならない（SHALL）。

#### Scenario: レジスタを表示
- **WHEN** ユーザーがレジスタ一覧を要求する（例：ヘルプコマンド経由）
- **THEN** 空でないすべてのレジスタがその内容とともに表示されなければならない（SHALL）

### Requirement: レジスタの永続性
システムはEmacsレジスタシステムと統合しなければならない（SHALL）。

#### Scenario: Emacsレジスタとの互換性
- **WHEN** ユーザーが `C-x r s a` でテキストを保存する
- **THEN** `' a y` は同じテキストを挿入しなければならない（SHALL）

#### Scenario: 位置レジスタとの互換性
- **WHEN** ユーザーが `C-x r SPC a` で位置を保存する
- **THEN** `' a` はその位置にジャンプしなければならない（SHALL）
