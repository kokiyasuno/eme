schema: spec-driven

context: |
  プロジェクト: Emacsモーダル編集パッケージ
  言語: Emacs Lisp
  対象バージョン: Emacs 29.1+
  テスト: buttercup (BDD style)
  パッケージマネージャ: package.el互換

  重要: すべてのドキュメント、コミュニケーションを日本語で行う

  設計哲学:
  - CLライブラリ（cl-lib）の使用を禁止する
  - 外部ライブラリへの依存を最小限に抑え、可能な限りEmacs組み込み機能で実装する
  - Evil/Meowのような複雑さを避け、シンプルな設計を追求する
  - KakouneやHelixのようなモダンなモーダルエディティングの思想を取り入れる
  - すべてのキーバインドを設定ファイルで完全にカスタマイズ可能にする
  - 既存のEmacsキーバインドとの衝突を最小化する
  - キーバインドはキーボード配列に依存せず、機能の意味を表す文字を使用する
  - Emacsの標準キーバインド規則を尊重する（例: nでnext-line、pでprevious-line）
  - Vim互換性を追求しない（むしろVimの設計判断を見直す立場をとる）

rules:
  proposal:
    - ロールバック手順（アンインストール方法）を含める
    - 既存パッケージ（Evil, Meow, Xah-fly-keys等）との明確な差別化を示す
    - パフォーマンスへの影響を見積もる
    - MELPA登録の計画を記載する
    - 外部依存の追加は必ず正当な理由を説明する

  specs:
    - Given/When/Then形式で記述する
    - キーバインドの競合シナリオを必ず含める
    - major-mode/minor-mode別の動作を明記する
    - Emacsバージョン互換性を明示する
    - エッジケース（edge case）を網羅する

  design:
    - ファイル構成（main, core, keybinds, utils等）を明記する
    - adviceやhookの使用箇所を文書化する
    - カスタマイズ変数の命名規則を説明する
    - パフォーマンスクリティカルな部分を特定する
    - 他パッケージとの統合ポイント（which-key, hydra等）をリストアップする
    - cl-lib使用の代替実装を提示する

  tasks:
    - 各タスクは単一ファイルまたは単一機能の実装単位とする
    - テストタスクを実装タスクと対にして記載する
    - 外部依存を追加する場合は理由をコメントで説明する
    - MELPA向けパッケージメタデータを最終タスクとする
    - 手動テストが必要な項目には[手動]マークを付ける
    - cl-lib関数を使用している箇所があれば[要修正]マークを付ける
